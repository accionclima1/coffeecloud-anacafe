var utils = {
    addSelectOption: function (selectbox, value, text) {
        var optn = document.createElement("OPTION");
        optn.text = text;
        optn.value = value;
        selectbox.options.add(optn);
    },
    addPreSelectOption: function (selectbox, value, text) {
        var optn = document.createElement("OPTION");
        optn.text = text;
        optn.value = value;
        optn.selected = true;
        selectbox.options.add(optn);
    },
    clearSelect: function (selectbox) { selectbox.innerHTML = ""; },
    insertAfter: function (newNode, nodeRef) { nodeRef.parentNode.insertBefore(newNode, nodeRef.nextSibling); }
};


var muni14 = {
    data: [

      {dept:"Atlántida",
      munis:["La Ceiba","Tela","Jutiapa","La Masica","San Francisco","Arizona","Esparta","El Porvenir"]},
      {dept:"Colón",
      munis:["Trujillo","Balfate","Iriona","Limón","Sabá","Santa Fe","Santa Rosa de Aguán","Sonaguera","Tocoa","Bonito Oriental"]},
      {dept:"Comayagua",
      munis:["Comayagua","Ajuterique","El Rosario","Esquías","Humuya","La libertad","Lamaní","La Trinidad","Lejamani","Meambar","Minas de Oro","Ojos de Agua","San Jerónimo (Honduras)","San José de Comayagua","San José del Potrero","San Luis","San Sebastián","Siguatepeque","Villa de San Antonio","Las Lajas,Taulabé"]},
      {dept:"Copán",
      munis:["Santa Rosa de Copán","Cabañas","Concepción","Copán Ruinas","Corquín","Cucuyagua","Dolores","Dulce Nombre","El Paraíso","Florida","La Jigua","La Unión","Nueva Arcadia","San Agustín","San Antonio","San Jerónimo","San José","San Juan de Opoa","San Nicolás","San Pedro","Santa Rita","Trinidad de Copán","Veracruz"]},
      {dept:"Cortés",
      munis:["San Pedro Sula","Choloma","Omoa","Pimienta","Potrerillos","Puerto Cortés","San Antonio de Cortés","San Francisco de Yojoa","San Manuel","Santa Cruz de Yojoa","Villanueva","La Lima"]},
      {dept:"Choluteca",
      munis:["Choluteca","Apacilagua","Concepción de María","Duyure","El Corpus","El Triunfo","Marcovia","Morolica","Namasigue","Orocuina","Pespire","San Antonio de Flores","San Isidro","San José","San Marcos de Colón","Santa Ana de Yusguare"]},
      {dept:"El Paraíso",
      munis:["Yuscarán","Alauca","Danlí","El Paraíso","Güinope","Jacaleapa","Liure","Morocelí","Oropolí","Potrerillos","San Antonio de Flores","San Lucas","San Matías","Soledad","Teupasenti","Texiguat","Vado Ancho","Yauyupe","Trojes"]},
      {dept:"Francisco Morazán",
      munis:["Distrito Central","Alubarén","Cedros","Curarén","El Porvenir","Guaimaca","La Libertad","La Venta","Lepaterique","Maraita","Marale","Nueva Armenia","Ojojona","Orica","Reitoca","Sabanagrande","San Antonio de Oriente","San Buenaventura","San Ignacio","San Juan de Flores","San Miguelito","Santa Ana","Santa Lucía","Talanga","Tatumbla","Valle de Ángeles","Villa de San Francisco","Vallecillo"]},
      {dept:"Gracias a Dios",
      munis:["Puerto Lempira","Brus Laguna","Ahuas","Juan Francisco Bulnes","Ramón Villeda Morales","Wampusirpe"]},
      {dept:"Intibucá",
      munis:["La Esperanza","Camasca","Colomoncagua","Concepción","Dolores","Intibucá","Jesús de Otoro","Magdalena","Masaguara","San Antonio","San Isidro","San Juan","San Marcos de la Sierra","San Miguel Guancapla","Santa Lucía","Yamaranguila","San Francisco de Opalaca"]},
      {dept:"Islas de la Bahía",
      munis:["Roatán","Guanaja","José Santos Guardiola","Util"]},
      {dept:"La Paz",
      munis:["La Paz","Aguanqueterique","Cabañas","Cane","Chinacla","Guajiquiro","Lauterique","Marcala","Mercedes de Oriente","Opatoro","San Antonio del Norte","San José","San Juan","San Pedro de Tutule","Santa Ana","Santa Elena","Santa María","Santiago de Puringla","Yarula"]},
      {dept:"Lempira",
      munis:["Gracias","Belén","Candelaria","Cololaca","Erandique","Gualcince","Guarita","La Campa","La Iguala","Las Flores","La Unión","La Virtud","Lepaera","Mapulaca","Piraera","San Andrés","San Francisco","San Juan Guarita","San Manuel Colohete","San Rafael","San Sebastián","Santa Cruz","Talgua","Tambla","Tomalá","Valladolid","Virginia","San Marcos de Caiquín"]},
      {dept:"Ocotepeque",
      munis:["Ocotepeque","Belén Gualcho","Concepción","Dolores Merendón","Fraternidad","La Encarnación","La Labor","Lucerna","Mercedes","San Fernando","San Francisco del Valle","San Jorge","San Marcos","Santa Fe","Sensenti","Sinuapa"]},
      {dept:"Olancho",
      munis:["Juticalpa","Campamento","Catacamas","Concordia","Dulce Nombre de Culmí","El Rosario","Esquipulas del Norte","Gualaco","Guarizama","Guata","Guayape","Jano","La Unión","Mangulile","Manto","Salamá","San Esteban","San Francisco de Becerra","San Francisco de la Paz","Santa María del Real","Silca","Yocón","Patuca"]},
      {dept:"Santa Bárbara",
      munis:["Santa Bárbara","Arada","Atima","Azacualpa","Ceguaca","Concepción del Norte","Concepción del Sur","Chinda","El Níspero","Gualala","Ilama","Las Vegas","Macuelizo","Naranjito","Nuevo Celilac","Nueva Frontera","Petoa","Protección","Quimistán","San Francisco de Ojuera","San José de las Colinas","San Luis","San Marcos","San Nicolás","San Pedro Zacapa","San Vicente Centenario","Santa Rita","Trinidad"]},
      {dept:"Valle",
      munis:["Nacaome","Alianza","Amapala","Aramecina","Caridad","Goascorán","Langue","San Francisco de Coray","San Lorenzo"]},
      {dept:"Yoro",
      munis:["Yoro","Arenal","El Negrito","El Progreso","Jocón","Morazán","Olanchito","Santa Rita","Sulaco","Victoria","Yorito"]}


		],
    addDepts: function (selectDeptId) {
        var selectDept = document.getElementById(selectDeptId);
            deps = [];
            deps.push("");
        for (var i = 0, t = this.data.length; i < t; i++) {
            deps.push(this.data[i].dept);
        }
        deps.sort();

        for (var j = 0, t2 = deps.length; j < t2; j++) {
            utils.addSelectOption(selectDept, this.getDeptCode(deps[j]), deps[j])
        }



        var selectMunis = document.createElement("select");
        selectMunis.setAttribute("id", selectDept.getAttribute("id") + "-munis");
        selectMunis.setAttribute("class", "form-control");
        selectMunis.setAttribute("ng-model", "municipio");
        selectMunis.setAttribute("required", "required");
        selectMunis.setAttribute("data-error", "Campo Requerido");
        selectMunisCachedDisplay = selectMunis.style.display;
        selectMunis.style.display = "none";
        selectMunis.required = true;
        utils.insertAfter(selectMunis, selectDept);
        var that = this;
        selectDept.onchange = function () {
            var opt = this.value;
            if (opt > 0) {
                utils.clearSelect(selectMunis);
                utils.addSelectOption(selectMunis, " ", " ");
                var munis = that.data[--opt].munis;
                for (var i = 0, t = munis.length; i < t; i++) {
                    var code = i + 1;
                    utils.addSelectOption(selectMunis, code > 9 ? code : "0" + code, munis[i]);
                    selectMunis.style.display = selectMunisCachedDisplay
                }
            } else {
                utils.clearSelect(selectMunis); selectMunis.style.display = "none"
            }
        }
        selectDept.forcechange = function (opt,value) {
            if (opt > 0) {
                utils.clearSelect(selectMunis);
                utils.addSelectOption(selectMunis, " ", " ");
                var munis = that.data[--opt].munis;
                for (var i = 0, t = munis.length; i < t; i++) {
                    var code = i + 1;
                    var optval = munis[i];
                    if (optval == value)
                        utils.addPreSelectOption(selectMunis, code > 9 ? code : "0" + code, munis[i]);
                    else
                        utils.addSelectOption(selectMunis, code > 9 ? code : "0" + code, munis[i]);
                    selectMunis.style.display = selectMunisCachedDisplay
                }
            } else {
                utils.clearSelect(selectMunis);
                selectMunis.style.display = "none"
            }
        }
    },
    getDeptId: function (deptName) {
        console.log(this.data);
        var index = -1;
        for (var i = 0; i < this.data.length; i++) {
            var dname = this.data[i].dept;
            if (dname == deptName) {
                index = i;
            }
        }
        return index + 1;
    },
    getDept: function (id) {
        if (typeof id === "string") {
            id = parseInt(id, 10)
        } return (id > 0 && id < 15) ? this.data[--id].dept : ""
    },
    getMunis: function (deptId) {
        return this.getDept(deptId) !== "" ? this.data[--deptId].munis : ""
    },
    getDeptCode: function (dept) {
        for (var i = 0, t = this.data.length; i < t; i++) {
            if (this.data[i].dept === dept) {
                var code = ++i; return code > 9 ? code : "0" + code
            }
        }
    },
    getDeptMuni: function (code) {
        if (code.match(/\d{4}/)) {
            var deptCode = code.substring(0, 2),
                muniCode = parseInt(code.substring(2), 10) - 1,
                dept = muni14.getDept(deptCode);
            if (dept !== "" && muniCode >= 0) {
                var munis = this.getMunis(deptCode);
                return muniCode < munis.length ? dept + ", " + munis[muniCode] : ""
            }
        }
    }
};
