var utils = {
    addSelectOption: function (selectbox, value, text) {
        var optn = document.createElement("OPTION");
        optn.text = text;
        optn.value = value;
        selectbox.options.add(optn);
    },
    addPreSelectOption: function (selectbox, value, text) {
        var optn = document.createElement("OPTION");
        optn.text = text;
        optn.value = value;
        optn.selected = true;
        selectbox.options.add(optn);
    },
    clearSelect: function (selectbox) { selectbox.innerHTML = ""; },
    insertAfter: function (newNode, nodeRef) { nodeRef.parentNode.insertBefore(newNode, nodeRef.nextSibling); }
};


var muni14 = {
    data: [

	{dept:"Baja Verapaz",
		munis:["Cubulco","Santa Cruz el Chol","Granados","Purulhá","Rabinal","Salamá","San Miguel Chicaj","San Jerónimo"]},

	{dept:"Petén",
		munis:["Melchor de Mencos","Flores","San José","San Andrés","La Libertad","San Benito","Santa Ana","Dolores","San Francisco","Sayaxché","Poptún","San Luis"]},

	{dept:"Jutiapa",
		munis:["Agua Blanca","Asunción Mita","Atescatempa","Comapa","Conguaco","El Adelanto","El Progreso","Jalpatagua","Jerez","Jutiapa","Moyuta","Pasaco","Quesada","San José Acatempa","Santa Catarina Mita","Yupiltepeque","Zapotitlán"]},

	{dept:"Quiché",
		munis:["Ixcán","Nebaj","Chajul","Uspantán","Chicamán","San Juan Cotzal","Cunén","San Andrés Sajcabajá","Sacapulas","Canillá","San Pedro Jocopilas","San Bartolomé Jocotenango","Zacualpa","San Antonio Ilotenango","Santa Cruz del Quiché","Joyabaj","Chinique","Chiché","Patzité","Chichicastenango","Pachalum",]},

	{dept:"Huehuetenango",
		munis:["Barillas","San Mateo Ixtatán","Nentón","San Sebastián Coatán","Santa Eulalia","Jacaltenango","Santa Ana Huista","San Miguel Acatán","San Rafael La Independencia","San Antonio Huista","Soloma","La Democracia","San Juan Ixcoy","Chiantla","La Libertad","Cuilco","Aguacatán","San Juan Atitán","San Idelfonso Ixtahuacán","San Sebastián Huehuetenango","Colotenango","San Rafael Pétzal","Tectitán","San Gaspar Ixchil","Santa Bárbara","Huehuetenango","Malacatancito","Unión Cantinil","Concepción Huista","Santiago Chimaltenango","San Pedro Necta","Todos Santos Cuchumatán"]},

	{dept:"Alta Verapaz",
		munis:["Fray Bartolomé de las Casas","Cobán","Chahal","San Pedro Carchá","Cahabón","Lanquín","Senahú","Panzós","San Cristóbal Verapaz","San Juan Chamelco","Santa Cruz Verapaz","Tucurú","Tamahú","Tactic","Santa Catarina La Tinta","Raxruja","Chisec"]},

	{dept:"Izabal",
		munis:["Puerto Barrios","Livingston","El Estor","Morales","Los Amates"]},

	{dept:"San Marcos",
		munis:["Tacaná","Concepción Tutuapa","San José Ojetenam","Sipacapa","Tejutla","Comitancillo","Ixchiguán","Sibinal","Tajumulco","Río Blanco","San Marcos","San Lorenzo","San Pablo","Malacatán","San Pedro Sacatepéquez","San Antonio Sacatepéquez","San Rafael Pie de la Cuesta","Esquipulas Palo Gordo","El Rodeo","San Cristóbal Cucho","El Tumbador","Nuevo Progreso","Catarina","La Reforma","El Quetzal","Pajapita","Ayutla","Ocós","San Miguel Ixtahuacán"]},

	{dept:"Zacapa",
		munis:["Gualán","Río Hondo","Teculután","Zacapa","Usumatlán","Estanzuela","La Unión","Huité","Cabañas","San Diego"]},

	{dept:"Escuintla",
		munis:["Iztapa","San José","La Gomera","Masagua","La Democracia","Guanagazapa","Nueva Concepción","Tiquisate","San Vicente Pacaya","Santa Lucia Cotzulmalguapa","Palín","Siquinalá","Escuintla"]},

	{dept:"Totonicapán",
		munis:["Momostenango","Santa Lucía La Reforma","San Bartolo Aguas Calientes","Santa María Chiquimula","San Francisco El Alto","San Cristóbal Totonicapán","Totonicapán","San Andrés Xecul"]},

	{dept:"Santa Rosa",
		munis:["San Juan Tecuaco","Guazacapán","Chiquimulilla","Taxisco","Santa María Ixhuatán","Oratorio","Pueblo Nuevo Viñas","Cuilapa","Barberena","Santa Cruz Naranjo","Nueva Santa Rosa","Casillas","San Rafael Las Flores","Santa Rosa de Lima",""]},

	{dept:"Quetzaltenango",

		munis:["San Carlos Sija","Cabricán","Huitán","Sibilia","Palestina de los Altos","Cajolá","San Francisco La Unión","San Juan Ostuncalco","San Miguel Sigüila","Olintepeque","La Esperanza","Salcajá","Quetzaltenango","San Mateo","Concepción Chiquirichapa","Cantel","San Martín Sacatepéquez","Colomba","Almolonga","Zunil","El Palmar","Coatepeque","Flores Costa Cuca","Génova"]},

	{dept:"Retalhuleu",
		munis:["Champerico","Retalhuleu","San Sebastián","Santa Cruz Muluá","San Martín Zapotitlán","San Andrés Villa Seca","El Asintal","San Felipe Retalhuleu","Nuevo San Carlos"]},

		{dept:"El Progreso",
		munis:["San Agustín Acasaguastlán","Morazán","San Cristóbal Acasguastlan","El Jícaro","Guastatoya","Sanarate","San Antonio La Paz","Sansare","San Miguel Panán","San Bernandino","Ciudad Vieja","Magdalena Milpas Altas","San Miguel Dueñas","San Antonio Aguas Calientes","Patulul","San Antonio Suchitepéquez"]},

		{dept:"Suchitepéquez",
		munis:["San Juan Bautista","Río Bravo","San José El Idolo","Santo Domingo Suchitepéquez","San Gabriel","San Miguel Panán","San Bernandino","Patulul","San Antonio Suchitepéquez","Santa Bárbara","Mazatenango","Samayac","Cuyotenango","San Pablo Jocopila","Santo Tomas La Unión","Chicacao","Zunilito","San Francisco Zapotitlán","Pueblo Nuevo","San Lorenzo"]},

		{dept:"Chiquimula",
		munis:["Jocotán","Chiquimula","Esquipulas","San Juan la Ermita","San José La Arada","Olopa","San Jacinto","Quetzaltepeque","Ipala","Concepción Las Minas","Camotan"]},

		{dept:"Guatemala",
		munis:["Chuarrancho","San Raymundo","San Juan Sacatepéquez","San José del Golfo","San Pedro Ayampuc","Chinautla","Palencia","San Pedro Sacatepéquez","Guatemala","Mixco","San José Pinula","Santa Catarina Pinula","Villa Nueva","Villa Canales","Fraijanes","Petapa","Amatitlán","Lago de Amatitlán"]},

		{dept:"Sacatepéquez",
		munis:["Alotenango","Santa María de Jesús","Ciudad Vieja","Magdalena Milpas Altas","San Miguel Dueñas","San Antonio Aguas Calientes","Santa Catarina Barahona","Santa Lucía Milpas Altas","Jocotenango","Antigua Guatemala","San Bartolomé Milpas Altas","San Lucas Sacatepéquez","Pastores","Santiago Sacatepéquez","Santo Domingo Xenacoj","Sumpango"]},

		{dept:"Chimaltenango",
		munis:["Tecpán Guatemala","San Martín Jilotepeque","San José Poaquil","Santa Apolonia","Comalapa","Chimaltenango","Zaragoza","El Tejar","Patzún","Santa Cruz Balanyá","Patzicía","San Andrés Itzapa","Parramos","Pochuta","Acatenango","Yepocapa"]},

		{dept:"Jalapa",
		munis:["San Carlos Alzatate","Monjas","San Manuel Chaparrón","Mataquescuintla","San Luis Jilotepeque","Jalapa","San Pedro Pinula"]},

		{dept:"Sololá",
		munis:["Sololá","Nahualá","Santa Catarina Ixtahuacán","Santa Lucía Utatlán","San Andrés Semetabaj","Concepción","San José Chacayá","Panajachel","Santa Cruz La Laguna","San Marcos La Laguna","San Pablo La Laguna","Santa Clara La Laguna","Santa Catarina Palapó","Santa María Visitación","San Juan La Laguna","San Antonio Palapó","San Pedro La Laguna","Santiago Atitlán","San Lucas Tolimán",""]}


		],
    addDepts: function (selectDeptId) {
        var selectDept = document.getElementById(selectDeptId);
            deps = [];
            deps.push("");
        for (var i = 0, t = this.data.length; i < t; i++) {
            deps.push(this.data[i].dept);
        }
        deps.sort();

        for (var j = 0, t2 = deps.length; j < t2; j++) {
            utils.addSelectOption(selectDept, this.getDeptCode(deps[j]), deps[j])
        }



        var selectMunis = document.createElement("select");
        selectMunis.setAttribute("id", selectDept.getAttribute("id") + "-munis");
        selectMunis.setAttribute("class", "form-control");
        selectMunis.setAttribute("ng-model", "municipio");
        selectMunis.setAttribute("data-error", "Campo Requerido");
        selectMunisCachedDisplay = selectMunis.style.display;
        selectMunis.style.display = "none";
        selectMunis.required = true;
        utils.insertAfter(selectMunis, selectDept);
        var that = this;
        selectDept.onchange = function () {
            var opt = this.value;
            if (opt > 0) {
                utils.clearSelect(selectMunis);
                utils.addSelectOption(selectMunis, " ", " ");
                var munis = that.data[--opt].munis;
                for (var i = 0, t = munis.length; i < t; i++) {
                    var code = i + 1;
                    utils.addSelectOption(selectMunis, code > 9 ? code : "0" + code, munis[i]);
                    selectMunis.style.display = selectMunisCachedDisplay
                }
            } else {
                utils.clearSelect(selectMunis); selectMunis.style.display = "none"
            }
        }
        selectDept.forcechange = function (opt,value) {
            if (opt > 0) {
                utils.clearSelect(selectMunis);
                utils.addSelectOption(selectMunis, " ", " ");
                var munis = that.data[--opt].munis;
                for (var i = 0, t = munis.length; i < t; i++) {
                    var code = i + 1;
                    var optval = munis[i];
                    if (optval == value)
                        utils.addPreSelectOption(selectMunis, code > 9 ? code : "0" + code, munis[i]);
                    else
                        utils.addSelectOption(selectMunis, code > 9 ? code : "0" + code, munis[i]);
                    selectMunis.style.display = selectMunisCachedDisplay
                }
            } else {
                utils.clearSelect(selectMunis);
                selectMunis.style.display = "none"
            }
        }
    },
    getDeptId: function (deptName) {
        console.log(this.data);
        var index = -1;
        for (var i = 0; i < this.data.length; i++) {
            var dname = this.data[i].dept;
            if (dname == deptName) {
                index = i;
            }
        }
        return index + 1;
    },
    getDept: function (id) {
        if (typeof id === "string") {
            id = parseInt(id, 10)
        } return (id > 0 && id < 15) ? this.data[--id].dept : ""
    },
    getMunis: function (deptId) {
        return this.getDept(deptId) !== "" ? this.data[--deptId].munis : ""
    },
    getDeptCode: function (dept) {
        for (var i = 0, t = this.data.length; i < t; i++) {
            if (this.data[i].dept === dept) {
                var code = ++i; return code > 9 ? code : "0" + code
            }
        }
    },
    getDeptMuni: function (code) {
        if (code.match(/\d{4}/)) {
            var deptCode = code.substring(0, 2),
                muniCode = parseInt(code.substring(2), 10) - 1,
                dept = muni14.getDept(deptCode);
            if (dept !== "" && muniCode >= 0) {
                var munis = this.getMunis(deptCode);
                return muniCode < munis.length ? dept + ", " + munis[muniCode] : ""
            }
        }
    }
};
